<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta name="description" content="This article is part of the series Build your very own self-hosting platform with Raspberry Pi and Kubernetes  Introduction Install Raspbian Operating-System and prepare the system for Kubernetes Ins">
<meta property="og:type" content="article">
<meta property="og:title" content="(K3S - 3&#x2F;8) Install and configure a Kubernetes cluster with k3s to self-host applications">
<meta property="og:url" content="https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/index.html">
<meta property="og:site_name" content="Gr3g">
<meta property="og:description" content="This article is part of the series Build your very own self-hosting platform with Raspberry Pi and Kubernetes  Introduction Install Raspbian Operating-System and prepare the system for Kubernetes Ins">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://gateway.pinata.cloud/ipfs/QmNij6VSLpX25UNBJaPm4FowsaLMqPE5yyRQh92Zv3GmpZ">
<meta property="og:image" content="https://i.imgur.com/DQI2Nwr.png">
<meta property="og:image" content="https://s14-eu5.startpage.com/cgi-bin/serveimage?url=https://miro.medium.com/max/5760/1*xA3NgdUJHa0t09NH3xPv-A.png&sp=c9182253abe18efb13bc730e52fda946">
<meta property="og:image" content="https://i.imgur.com/7xW77VN.png">
<meta property="og:image" content="https://i.imgur.com/Ky9zXpH.png">
<meta property="article:published_time" content="2020-04-12T22:00:03.000Z">
<meta property="article:modified_time" content="2026-02-15T13:45:25.576Z">
<meta property="article:author" content="Gr3g">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://gateway.pinata.cloud/ipfs/QmNij6VSLpX25UNBJaPm4FowsaLMqPE5yyRQh92Zv3GmpZ">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon.ico" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico">
        
      
    
    <!-- title -->
    <title>(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
      
<link rel="stylesheet" href="/css/rtl.css">

    
    <!-- rss -->
    
    
<meta name="generator" content="Hexo 5.2.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/blog/">Blog</a></li>
         
          <li><a href="/guides/">Guides</a></li>
         
          <li><a href="/about/">About me</a></li>
        
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" href="/2020/04/12/deploy-nextcloud-on-kuberbetes--the-self-hos/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" href="/2020/04/12/install-raspbian-operating-system-and-prepar/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&text=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&title=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&is_video=false&description=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications&body=Check out this article: https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/"><i class="fas fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&title=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&title=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&title=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&title=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&name=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&t=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-k3s-server-master-node"><span class="toc-number">2.</span> <span class="toc-text">Install k3s server (master node)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-k3s-agent-worker-nodes"><span class="toc-number">3.</span> <span class="toc-text">Install k3s agent (worker nodes)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Connect-remotely-to-the-cluster"><span class="toc-number">4.</span> <span class="toc-text">Connect remotely to the cluster</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-Helm-version-gt-3-x-y-Kubernetes-Package-Manager"><span class="toc-number">5.</span> <span class="toc-text">Install Helm (version &gt;&#x3D; 3.x.y) - Kubernetes Package Manager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-MetalLB-Kubernetes-Load-Balancer"><span class="toc-number">6.</span> <span class="toc-text">Install MetalLB - Kubernetes Load Balancer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-Nginx-Web-Proxy"><span class="toc-number">7.</span> <span class="toc-text">Install Nginx - Web Proxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-cert-manager"><span class="toc-number">8.</span> <span class="toc-text">Install cert-manager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-Kubernetes-Dashboard"><span class="toc-number">9.</span> <span class="toc-text">Install Kubernetes Dashboard</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Conclusion"><span class="toc-number">10.</span> <span class="toc-text">Conclusion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Teardown"><span class="toc-number">11.</span> <span class="toc-text">Teardown</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Known-Issues"><span class="toc-number">12.</span> <span class="toc-text">Known Issues</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        <header id="header">
  <a href="/">
  
    
      <div id="logo" style="background-image: url(/images/logo.png);"></div>
    
  
    <div id="title">
      <h1>Gr3g</h1>
    </div>
  </a>
  <div id="nav">
    <ul>
      <li class="icon">
        <a href="#"><i class="fas fa-bars fa-2x"></i></a>
      </li>
       
        <li><a href="/">Home</a></li>
       
        <li><a href="/blog/">Blog</a></li>
       
        <li><a href="/guides/">Guides</a></li>
       
        <li><a href="/about/">About me</a></li>
      
    </ul>
  </div>
</header>

        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        (K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications
    </h1>



    <div class="meta">
      <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">Gr3g</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2020-04-12T22:00:03.000Z" itemprop="datePublished">2020-04-13</time>
        
      
    </div>


      

      

    </div>
  </header>
  

  <div class="content" itemprop="articleBody">
    <p><img src="https://gateway.pinata.cloud/ipfs/QmNij6VSLpX25UNBJaPm4FowsaLMqPE5yyRQh92Zv3GmpZ"></p>
<p>This article is part of the series <em>Build your very own self-hosting platform with Raspberry Pi and Kubernetes</em></p>
<ol>
<li><a href="/2020/04/13/build-your-very-own-self-hosting-platform-wi">Introduction</a></li>
<li><a href="/2020/04/13/install-raspbian-operating-system-and-prepar">Install Raspbian Operating-System and prepare the system for Kubernetes</a></li>
<li><a href="/2020/04/13/install-and-configure-a-kubernetes-cluster-w">Install and configure a Kubernetes cluster with k3s to self-host applications</a></li>
<li><a href="/2020/04/13/deploy-nextcloud-on-kuberbetes--the-self-hos">Deploy NextCloud on Kuberbetes: The self-hosted Dropbox</a></li>
<li><a href="/2020/04/13/self-host-your-media-center-on-kubernetes-wi">Self-host your Media Center On Kubernetes with Plex, Sonarr, Radarr, Transmission and Jackett</a></li>
<li><a href="/2020/04/13/self-host-pi-hole-on-kubernetes-and-block-ad">Self-host Pi-Hole on Kubernetes and block ads and trackers at the network level</a></li>
<li><a href="/2020/04/13/self-host-your-password-manager-with-bitward">Self-host your password manager with Bitwarden</a></li>
<li><a href="/2020/04/13/deploy-prometheus-and-grafana-to-monitor-a-k">Deploy Prometheus and Grafana to monitor a Kubernetes cluster</a></li>
</ol>
<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>In the previous article, we freshly prepared three machines (one master and two workers). In this article, we are going to learn how to install Kubernetes using <a target="_blank" rel="noopener" href="https://k3s.io/">k3s</a>, a lightweight version of Kubernetes, suitable for ARM-based computers such as Raspberry Pi. If you need any support with k3s, I recommend checking the <a target="_blank" rel="noopener" href="https://rancher.com/docs/k3s/latest/en/">official documentation</a> as well as the <a target="_blank" rel="noopener" href="https://github.com/rancher/k3s">GitHub repository</a>.</p>
<p>Once the cluster is up and each node connected to each other, we will install some useful services such as:</p>
<ul>
<li><strong><a target="_blank" rel="noopener" href="https://helm.sh/">Helm</a>:</strong> Package manager for Kubernetes</li>
<li><strong><a target="_blank" rel="noopener" href="https://metallb.universe.tf/">MetalLB</a>:</strong> Load-balancer implementation for bare metal Kubernetes clusters</li>
<li><strong><a target="_blank" rel="noopener" href="https://github.com/kubernetes/ingress-nginx">Nginx</a>:</strong> Kubernetes Ingress Proxy</li>
<li><strong><a target="_blank" rel="noopener" href="https://cert-manager.io/">Cert Manager</a>:</strong> Native Kubernetes certificate management controller.</li>
<li><strong><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">Kubernetes Dashboard</a>:</strong> A web-based Kubernetes user interface</li>
</ul>
<h3 id="Install-k3s-server-master-node"><a href="#Install-k3s-server-master-node" class="headerlink" title="Install k3s server (master node)"></a>Install k3s server (master node)</h3><p>In the first part of this article, we will install the Kubernetes master node which represents the orchestrator of the cluster.</p>
<p><strong>1. Connect via ssh to the master node</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh pi@192.168.0.22</span><br></pre></td></tr></table></figure>


<p><strong>2. Configure the following environment variables</strong></p>
<p>The first line specifies in which mode we would like to write the k3s configuration (required when not running commands as <code>root</code>) and the second line actually says k3s not to deploy its default load balancer named <em>servicelb</em> and proxy <em>traefik</em>, instead we will install manually <a target="_blank" rel="noopener" href="https://metallb.universe.tf/"><em>metalb</em></a> as load balancer and <a target="_blank" rel="noopener" href="https://www.nginx.com/"><em>nginx</em></a> as proxy which are in my opinion better and more widely used.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ export K3S_KUBECONFIG_MODE&#x3D;&quot;644&quot;</span><br><span class="line">$ export INSTALL_K3S_EXEC&#x3D;&quot; --no-deploy servicelb --no-deploy traefik&quot;</span><br></pre></td></tr></table></figure>


<p><strong>3. Run the installer</strong></p>
<p>The next command simply downloads and executes the k3s installer. The installation will take into account the environment variables set just before.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ curl -sfL https:&#x2F;&#x2F;get.k3s.io | sh -</span><br><span class="line"></span><br><span class="line">[INFO]  Finding latest release</span><br><span class="line">[INFO]  Using v1.17.0+k3s.1 as release</span><br><span class="line">[INFO]  Downloading hash https:&#x2F;&#x2F;github.com&#x2F;rancher&#x2F;k3s&#x2F;releases&#x2F;download&#x2F;v1.17.0+k3s.1&#x2F;sha256sum-arm.txt</span><br><span class="line">[INFO]  Downloading binary https:&#x2F;&#x2F;github.com&#x2F;rancher&#x2F;k3s&#x2F;releases&#x2F;download&#x2F;v1.17.0+k3s.1&#x2F;k3s-armhf</span><br><span class="line">[INFO]  Verifying binary download</span><br><span class="line">[INFO]  Installing k3s to &#x2F;usr&#x2F;local&#x2F;bin&#x2F;k3s</span><br><span class="line">[INFO]  Creating &#x2F;usr&#x2F;local&#x2F;bin&#x2F;kubectl symlink to k3s</span><br><span class="line">[INFO]  Creating &#x2F;usr&#x2F;local&#x2F;bin&#x2F;crictl symlink to k3s</span><br><span class="line">[INFO]  Creating &#x2F;usr&#x2F;local&#x2F;bin&#x2F;ctr symlink to k3s</span><br><span class="line">[INFO]  Creating killall script &#x2F;usr&#x2F;local&#x2F;bin&#x2F;k3s-killall.sh</span><br><span class="line">[INFO]  Creating uninstall script &#x2F;usr&#x2F;local&#x2F;bin&#x2F;k3s-uninstall.sh</span><br><span class="line">[INFO]  env: Creating environment file &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;k3s.service.env</span><br><span class="line">[INFO]  systemd: Creating service file &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;k3s.service</span><br><span class="line">[INFO]  systemd: Enabling k3s unit</span><br><span class="line">Created symlink &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;multi-user.target.wants&#x2F;k3s.service → &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;k3s.service.</span><br><span class="line">[INFO]  systemd: Starting k3s</span><br></pre></td></tr></table></figure>


<p><strong>4. Verify the status</strong></p>
<p>The installer creates a systemd service which can be used for <code>stop</code>, <code>start</code>, <code>restart</code> and verify the <code>status</code> of the k3s server running Kubernetes.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl status k3s</span><br><span class="line"></span><br><span class="line">● k3s.service - Lightweight Kubernetes</span><br><span class="line">   Loaded: loaded (&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;k3s.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Fri 2020-01-10 19:26:41 GMT; 9s ago</span><br><span class="line">     Docs: https:&#x2F;&#x2F;k3s.io</span><br><span class="line">  Process: 900 ExecStartPre&#x3D;&#x2F;sbin&#x2F;modprobe br_netfilter (code&#x3D;exited, status&#x3D;0&#x2F;SUCCESS)</span><br><span class="line">  Process: 902 ExecStartPre&#x3D;&#x2F;sbin&#x2F;modprobe overlay (code&#x3D;exited, status&#x3D;0&#x2F;SUCCESS)</span><br><span class="line"> Main PID: 904 (k3s-server)</span><br><span class="line">    Tasks: 14</span><br><span class="line">   Memory: 395.0M</span><br><span class="line">(...)</span><br></pre></td></tr></table></figure>

<p>k3s also installed the <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/kubectl/overview/">Kubernetes Command Line Tools</a> <code>kubectl</code>, so it is possible to start querying the cluster (composed at this stage, of only one node - the master, and a few internal services used by Kubernetes).</p>
<ul>
<li>To get the details of the nodes</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get nodes -o wide</span><br><span class="line"></span><br><span class="line">NAME          STATUS   ROLES    AGE   VERSION         INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION   CONTAINER-RUNTIME</span><br><span class="line">kube-master   Ready    master   29m   v1.17.0+k3s.1   192.168.0.22   &lt;none&gt;        Raspbian GNU&#x2F;Linux 10 (buster)   4.19.75-v7l+     containerd:&#x2F;&#x2F;1.3.0-k3s.5</span><br></pre></td></tr></table></figure>

<ul>
<li>To get the details of all the services deployed</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods -A -o wide</span><br><span class="line"></span><br><span class="line">NAMESPACE     NAME                                      READY   STATUS    RESTARTS   AGE   IP          NODE          NOMINATED NODE   READINESS GATES</span><br><span class="line">kube-system   metrics-server-6d684c7b5-w2qdj            1&#x2F;1     Running   0          30m   10.42.0.3   kube-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   local-path-provisioner-58fb86bdfd-jmdjh   1&#x2F;1     Running   0          30m   10.42.0.4   kube-master   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   coredns-d798c9dd-vh56g                    1&#x2F;1     Running   0          30m   10.42.0.2   kube-master   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>


<p><strong>5. Save the access token</strong></p>
<p>Each agent will require an access token to connect to the server, the token can be retrieved with the following commands:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cat &#x2F;var&#x2F;lib&#x2F;rancher&#x2F;k3s&#x2F;server&#x2F;node-token</span><br><span class="line"></span><br><span class="line">K106edce2ad174510a840ff7e49680fc556f8830173773a1ec1a5dc779a83d4e35b::server:5a9b70a1f5bc02a7cf775f97fa912345</span><br></pre></td></tr></table></figure>



<h3 id="Install-k3s-agent-worker-nodes"><a href="#Install-k3s-agent-worker-nodes" class="headerlink" title="Install k3s agent (worker nodes)"></a>Install k3s agent (worker nodes)</h3><p>In the second part, we are now installing the k3s agent to connect on each worker to the k3s server (master).</p>
<p><strong>1. Connect via ssh to the worker node</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ssh pi@192.168.0.23</span><br></pre></td></tr></table></figure>


<p><strong>2. Configure the following environment variables</strong></p>
<p>The first line specifies in which mode we would like to write the k3s configuration (required when not running command as <code>root</code>) and the second line provide the k3s server endpoint the agent needs to connect to. Finally, the third line is an access token to the k3s server saved previously.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ export K3S_KUBECONFIG_MODE&#x3D;&quot;644&quot;</span><br><span class="line">$ export K3S_URL&#x3D;&quot;https:&#x2F;&#x2F;192.168.0.22:6443&quot;</span><br><span class="line">$ export K3S_TOKEN&#x3D;&quot;K106edce2ad174510a840ff7e49680fc556f8830173773a1ec1a5dc779a83d4e35b::server:5a9b70a1f5bc02a7cf775f97fa912345&quot;</span><br></pre></td></tr></table></figure>


<p><strong>3. Run the installer</strong></p>
<p>The next command simply downloads and executes the k3s installer. The installation will take into account the environment variables set just before and install the agent.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ curl -sfL https:&#x2F;&#x2F;get.k3s.io | sh -</span><br><span class="line"></span><br><span class="line">[INFO]  Finding latest release</span><br><span class="line">[INFO]  Using v1.17.0+k3s.1 as release</span><br><span class="line">[INFO]  Downloading hash https:&#x2F;&#x2F;github.com&#x2F;rancher&#x2F;k3s&#x2F;releases&#x2F;download&#x2F;v1.17.0+k3s.1&#x2F;sha256sum-arm64.txt</span><br><span class="line">[INFO]  Downloading binary https:&#x2F;&#x2F;github.com&#x2F;rancher&#x2F;k3s&#x2F;releases&#x2F;download&#x2F;v1.17.0+k3s.1&#x2F;k3s-arm64</span><br><span class="line">[INFO]  Verifying binary download</span><br><span class="line">[INFO]  Installing k3s to &#x2F;usr&#x2F;local&#x2F;bin&#x2F;k3s</span><br><span class="line">[INFO]  Creating &#x2F;usr&#x2F;local&#x2F;bin&#x2F;kubectl symlink to k3s</span><br><span class="line">[INFO]  Creating &#x2F;usr&#x2F;local&#x2F;bin&#x2F;crictl symlink to k3s</span><br><span class="line">[INFO]  Creating &#x2F;usr&#x2F;local&#x2F;bin&#x2F;ctr symlink to k3s</span><br><span class="line">[INFO]  Creating killall script &#x2F;usr&#x2F;local&#x2F;bin&#x2F;k3s-killall.sh</span><br><span class="line">[INFO]  Creating uninstall script &#x2F;usr&#x2F;local&#x2F;bin&#x2F;k3s-agent-uninstall.sh</span><br><span class="line">[INFO]  env: Creating environment file &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;k3s-agent.service.env</span><br><span class="line">[INFO]  systemd: Creating service file &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;k3s-agent.service</span><br><span class="line">[INFO]  systemd: Enabling k3s-agent unit</span><br><span class="line">Created symlink &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;multi-user.target.wants&#x2F;k3s-agent.service → &#x2F;etc&#x2F;systemd&#x2F;system&#x2F;k3s-agent.service.</span><br><span class="line">[INFO]  systemd: Starting k3s-agent</span><br></pre></td></tr></table></figure>


<p><strong>4. Verify the status</strong></p>
<p>The installer creates a systemd service which can be used for <code>stop</code>, <code>start</code>, <code>restart</code> and verify the <code>status</code> of the k3s agent running Kubernetes.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ sudo systemctl status k3s-agent</span><br><span class="line"></span><br><span class="line">● k3s-agent.service - Lightweight Kubernetes</span><br><span class="line">   Loaded: loaded (&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;k3s-agent.service; enabled; vendor preset: enabled)</span><br><span class="line">   Active: active (running) since Sun 2020-01-12 16:03:07 UTC; 9s ago</span><br><span class="line">     Docs: https:&#x2F;&#x2F;k3s.io</span><br><span class="line">  Process: 4970 ExecStartPre&#x3D;&#x2F;sbin&#x2F;modprobe br_netfilter (code&#x3D;exited, status&#x3D;0&#x2F;SUCCESS)</span><br><span class="line">  Process: 4973 ExecStartPre&#x3D;&#x2F;sbin&#x2F;modprobe overlay (code&#x3D;exited, status&#x3D;0&#x2F;SUCCESS)</span><br><span class="line"> Main PID: 4974 (k3s-agent)</span><br><span class="line">    Tasks: 16</span><br><span class="line">   Memory: 205.1M</span><br><span class="line">(...)</span><br></pre></td></tr></table></figure>

<p>k3s also installed the <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/reference/kubectl/overview/">Kubernetes Command Line Tools</a> <code>kubectl</code>, so it is possible to start querying the cluster and observe the all nodes are reconciliated.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get nodes -o wide</span><br><span class="line"></span><br><span class="line">NAME           STATUS   ROLES    AGE     VERSION         INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION     CONTAINER-RUNTIME</span><br><span class="line">kube-master    Ready    master   44h     v1.17.0+k3s.1   192.168.0.22   &lt;none&gt;        Raspbian GNU&#x2F;Linux 10 (buster)   4.19.75-v7l+       containerd:&#x2F;&#x2F;1.3.0-k3s.5</span><br><span class="line">kube-worker1   Ready    &lt;none&gt;   2m47s   v1.17.0+k3s.1   192.168.0.23   &lt;none&gt;        Debian GNU&#x2F;Linux 10 (buster)     5.4.6-rockchip64   containerd:&#x2F;&#x2F;1.3.0-k3s.5</span><br><span class="line">kube-worker2   Ready    &lt;none&gt;   2m9s    v1.17.0+k3s.1   192.168.0.24   &lt;none&gt;        Raspbian GNU&#x2F;Linux 10 (buster)   4.19.75-v7+        containerd:&#x2F;&#x2F;1.3.0-k3s.5</span><br></pre></td></tr></table></figure>




<h3 id="Connect-remotely-to-the-cluster"><a href="#Connect-remotely-to-the-cluster" class="headerlink" title="Connect remotely to the cluster"></a>Connect remotely to the cluster</h3><p>If you don’t want to connect via SSH to a node every time you need to query your cluster, it is possible to install <code>kubectl</code> (k8s command line tool) on your local machine and control remotely your cluster.</p>
<p><strong>1. Install kubectl on your local machine</strong></p>
<p>Read the <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">following page</a> to know how to install <code>kubectl</code> on Linux, MacOS or Windows.</p>
<p><strong>2. Copy the k3s config file from the master node to your local machine</strong></p>
<p>The command <code>scp</code> allows to transfer file via SSH from/to a remote machine. We simply need to download the file <code>/etc/rancher/k3s/k3s.yaml</code> located on the master node to our local machine into <code>~/.kube/config</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ scp pi@192.168.0.22:&#x2F;etc&#x2F;rancher&#x2F;k3s&#x2F;k3s.yaml ~&#x2F;.kube&#x2F;config</span><br></pre></td></tr></table></figure>

<p>The file contains a localhost endpoint <code>127.0.0.1</code>, we just need to replace this by the IP address of the master node instead (in my case <code>192.168.0.22</code>).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sed -i &#39;&#39; &#39;s&#x2F;127\.0\.0\.1&#x2F;192\.168\.0\.22&#x2F;g&#39; ~&#x2F;.kube&#x2F;config</span><br></pre></td></tr></table></figure>


<p><strong>3. Try using <code>kubectl</code> from your local machine</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get nodes -o wide</span><br><span class="line"></span><br><span class="line">NAME           STATUS   ROLES    AGE   VERSION         INTERNAL-IP    EXTERNAL-IP   OS-IMAGE                         KERNEL-VERSION     CONTAINER-RUNTIME</span><br><span class="line">kube-worker1   Ready    &lt;none&gt;   18m   v1.17.0+k3s.1   192.168.0.23   &lt;none&gt;        Debian GNU&#x2F;Linux 10 (buster)     5.4.6-rockchip64   containerd:&#x2F;&#x2F;1.3.0-k3s.5</span><br><span class="line">kube-worker2   Ready    &lt;none&gt;   17m   v1.17.0+k3s.1   192.168.0.24   &lt;none&gt;        Raspbian GNU&#x2F;Linux 10 (buster)   4.19.75-v7+        containerd:&#x2F;&#x2F;1.3.0-k3s.5</span><br><span class="line">kube-master    Ready    master   44h   v1.17.0+k3s.1   192.168.0.22   &lt;none&gt;        Raspbian GNU&#x2F;Linux 10 (buster)   4.19.75-v7l+       containerd:&#x2F;&#x2F;1.3.0-k3s.5</span><br></pre></td></tr></table></figure>





<h3 id="Install-Helm-version-gt-3-x-y-Kubernetes-Package-Manager"><a href="#Install-Helm-version-gt-3-x-y-Kubernetes-Package-Manager" class="headerlink" title="Install Helm (version &gt;= 3.x.y) - Kubernetes Package Manager"></a>Install Helm (version &gt;= 3.x.y) - Kubernetes Package Manager</h3><p><a target="_blank" rel="noopener" href="https://helm.sh/">Helm</a> is a package manager for Kubernetes. An application deployed on Kubernetes is usually composed of multiple config files (deployment, service, secret, ingress, etc.) which can be more or less complex and are generally the same for common applications.</p>
<p>Helm provides a solution to define, install, upgrade k8s applications based on config templates (called <em>charts</em>). A simple unique config file (names Values.yml) is used to generate all the necessary k8s config files and deploy them. The repository <a target="_blank" rel="noopener" href="https://hub.helm.sh/">hub.helm.sh</a> contains all the “official” charts available but you can easily find unofficial charts online.</p>
<p><strong>1. Install Helm command line tools on your local machine</strong></p>
<p>Refer to the <a target="_blank" rel="noopener" href="https://helm.sh/docs/intro/install">following page</a> to install <code>helm</code> on your local machine. <strong>You must install Helm version &gt;= 3.x.y</strong></p>
<p>Example for Linux:</p>
<ul>
<li>Download the package on <a target="_blank" rel="noopener" href="https://github.com/helm/helm/releases">GitHub</a></li>
<li>Run <code>$ tar -zxvf helm-v3.&lt;X&gt;.&lt;Y&gt;-linux-amd64.tar.gz</code> (replace <code>3.&lt;Y&gt;.&lt;Y&gt;</code> by the latest version)</li>
<li>Execute <code>$ mv linux-amd64/helm /usr/local/bin/helm</code></li>
</ul>
<p><strong>2. Check the version</strong></p>
<p>Verify that you have Helm version 3.x installed.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ helm version</span><br><span class="line">version.BuildInfo&#123;Version:&quot;v3.0.2&quot;, GitCommit:&quot;19e47ee3283ae98139d98460de796c1be1e3975f&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;go1.13.5&quot;&#125;</span><br></pre></td></tr></table></figure>


<p><strong>3. Add the repository for official charts</strong></p>
<p>Configure the repository <code>stable https://kubernetes-charts.storage.googleapis.com</code> to access the <a target="_blank" rel="noopener" href="https://github.com/helm/charts/tree/master/stable">official charts</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ helm repo add stable https:&#x2F;&#x2F;kubernetes-charts.storage.googleapis.com</span><br><span class="line">&quot;stable&quot; has been added to your repositories</span><br><span class="line"></span><br><span class="line">$ helm repo update</span><br><span class="line">Hang tight while we grab the latest from your chart repositories...</span><br><span class="line">...Successfully got an update from the &quot;stable&quot; chart repository</span><br><span class="line">Update Complete. ⎈ Happy Helming!⎈</span><br></pre></td></tr></table></figure>



<p>We can now install application using Helm using <code>helm install &lt;deployment_name&gt; &lt;chart_name&gt; --namespace &lt;namespace&gt; --set &lt;property_value_to_change&gt;</code>, uninstall application running <code>helm uninstall &lt;deployment_name&gt; --namespace &lt;namespace&gt;</code> and list the applications with <code>helm list --namespace &lt;namespace&gt;</code></p>
<p>I also recommend checking this page to learn more <a target="_blank" rel="noopener" href="https://helm.sh/docs/intro/using_helm/">how to use Helm cli</a>.</p>
<h3 id="Install-MetalLB-Kubernetes-Load-Balancer"><a href="#Install-MetalLB-Kubernetes-Load-Balancer" class="headerlink" title="Install MetalLB - Kubernetes Load Balancer"></a>Install MetalLB - Kubernetes Load Balancer</h3><p><a target="_blank" rel="noopener" href="https://metallb.universe.tf/">MetalLB</a> is a load-balancer implementation for bare metal Kubernetes clusters. When configuring a <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/services-networking/service/">Kubernetes service</a> of type <em>LoadBalancer</em>, MetalLB will dedicate a virtual IP from an address-pool to be used as load balancer for an application.</p>
<p>To install MetalLB from Helm, you simply need to run the following command <code>helm install ...</code> with:</p>
<ul>
<li><code>metallb</code>: the name to give to the deployment</li>
<li><code>stable/metallb</code>: the name of the <a target="_blank" rel="noopener" href="https://github.com/helm/charts/tree/master/stable/metallb">chart</a></li>
<li><code>--namespace kube-system</code>: the namespace in which we want to deploy MetalLB.</li>
<li><code>--set configInline...</code>: to configures MetalLB in <strong>Layer 2</strong> mode (see <a target="_blank" rel="noopener" href="https://metallb.universe.tf/configuration/">documentation</a> for more details). The IPs range <code>192.168.0.240-192.168.0.250</code> is used to constitute a pool of virtual IP addresses.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ helm repo add stable https:&#x2F;&#x2F;charts.helm.sh&#x2F;stable</span><br><span class="line">$ helm install metallb stable&#x2F;metallb --namespace kube-system \</span><br><span class="line">  --set configInline.address-pools[0].name&#x3D;default \</span><br><span class="line">  --set configInline.address-pools[0].protocol&#x3D;layer2 \</span><br><span class="line">  --set configInline.address-pools[0].addresses[0]&#x3D;192.168.0.240-192.168.0.250</span><br></pre></td></tr></table></figure>

<p>After a few seconds, you should observe the MetalLB components deployed under <code>kube-system</code> namespace.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods -n kube-system -l app&#x3D;metallb -o wide</span><br><span class="line"></span><br><span class="line">NAMESPACE     NAME                                      READY   STATUS    RESTARTS   AGE     IP             NODE           NOMINATED NODE   READINESS GATES</span><br><span class="line">kube-system   metallb-speaker-s7cvp                     1&#x2F;1     Running   0          2m47s   192.168.0.22   kube-master    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   metallb-speaker-jx64v                     1&#x2F;1     Running   0          2m47s   192.168.0.23   kube-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   metallb-controller-6fb88ff94b-4g256       1&#x2F;1     Running   0          2m47s   10.42.1.7      kube-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kube-system   metallb-speaker-k5kbh                     1&#x2F;1     Running   0          2m47s   192.168.0.24   kube-worker2   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>All done. No every time a new Kubenertes service of type <em>LoadBalancer</em> is deployed, MetalLB will assign an IP from the pool to access the application.</p>
<h3 id="Install-Nginx-Web-Proxy"><a href="#Install-Nginx-Web-Proxy" class="headerlink" title="Install Nginx - Web Proxy"></a>Install Nginx - Web Proxy</h3><p><a target="_blank" rel="noopener" href="https://www.nginx.com/">Nginx</a> is a recognized high-performance web server / reverse proxy. It can be used as <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/services-networking/ingress/">Kubernetes Ingress</a> to expose HTTP and HTTPS routes from outside the cluster to services within the cluster.</p>
<p>Similarly to MetalLB, we will use the following <a target="_blank" rel="noopener" href="https://github.com/helm/charts/tree/master/stable/nginx-ingress">stable/nginx-ingress Helm chart</a> to install our proxy server.</p>
<p>The only config change done here is disabling <code>defaultBackend</code> which isn’t required.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ helm install nginx-ingress stable&#x2F;nginx-ingress --namespace kube-system \</span><br><span class="line">    --set defaultBackend.enabled&#x3D;false</span><br></pre></td></tr></table></figure>


<p>After a few seconds, you should observe the Nginx component deployed under <code>kube-system</code> namespace.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods -n kube-system -l app&#x3D;nginx-ingress -o wide</span><br><span class="line"></span><br><span class="line">NAME                                             READY   STATUS    RESTARTS   AGE     IP          NODE           NOMINATED NODE   READINESS GATES</span><br><span class="line">nginx-ingress-controller-996c5bf9-k4j64   1&#x2F;1     Running   0          76s   10.42.1.13   kube-worker1   &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>Interestingly, Nginx service is deployed in LoadBalancer mode, you can observe MetalLB allocates a virtual IP (column <code> EXTERNAL-IP</code>) to Nginx with the command here:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get services  -n kube-system -l app&#x3D;nginx-ingress -o wide</span><br><span class="line"></span><br><span class="line">NAME                            TYPE           CLUSTER-IP     EXTERNAL-IP     PORT(S)                      AGE   SELECTOR</span><br><span class="line">nginx-ingress-controller   LoadBalancer   10.43.253.188   192.168.0.240   80:30423&#x2F;TCP,443:32242&#x2F;TCP   92s   app&#x3D;nginx-ingress,component&#x3D;controller,release&#x3D;nginx-ingress</span><br></pre></td></tr></table></figure>

<p>From you local machine, you can try to externally access Nginx via the LoadBalancer IP (in my case <code>http://192.168.0.240</code>) and it should return the following message “404 not found” because nothing is deployed yet.</p>
<p><img src="https://i.imgur.com/DQI2Nwr.png"></p>
<h3 id="Install-cert-manager"><a href="#Install-cert-manager" class="headerlink" title="Install cert-manager"></a>Install cert-manager</h3><p><a target="_blank" rel="noopener" href="https://cert-manager.io/">Cert Manager</a> is a set of Kubernetes tools used to automatically deliver and manage x509 certificates against the ingress (Nginx in our case) and consequently secure via SSL all the HTTP routes with almost no configuration.</p>
<p><strong>1. Install the CustomResourceDefinition</strong></p>
<p>Install the CustomResourceDefinition resources.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply --validate&#x3D;false -f https:&#x2F;&#x2F;github.com&#x2F;jetstack&#x2F;cert-manager&#x2F;releases&#x2F;download&#x2F;v0.16.0&#x2F;cert-manager.crds.yaml</span><br></pre></td></tr></table></figure>


<p><strong>2. Configure the jetstack Helm repository</strong></p>
<p>cert-manager Helm charts aren’t hosted by the offical Helm hub, you need to configure a new repository named JetStack which maintains those charts (<a target="_blank" rel="noopener" href="https://github.com/jetstack/cert-manager/tree/master/deploy/charts/cert-manager">here</a>).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm repo add jetstack https:&#x2F;&#x2F;charts.jetstack.io &amp;&amp; helm repo update</span><br></pre></td></tr></table></figure>


<p><strong>3. Install cert-manager through Helm</strong></p>
<p>Run the following command to install the cert-manager components under the <code>kube-system</code> namespace.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ helm install cert-manager jetstack&#x2F;cert-manager --namespace kube-system  --version v0.16.0</span><br></pre></td></tr></table></figure>

<p>Check that all three cert-manager components are running.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods -n kube-system -l app.kubernetes.io&#x2F;instance&#x3D;cert-manager -o wide</span><br><span class="line"></span><br><span class="line">NAME                                       READY   STATUS    RESTARTS   AGE   IP           NODE           NOMINATED NODE   READINESS GATES</span><br><span class="line">cert-manager-cainjector-6659d6844d-w9vrn   1&#x2F;1     Running   0          69s   10.42.1.13   kube-worker1   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">cert-manager-859957bd4c-2nzqp              1&#x2F;1     Running   0          69s   10.42.0.16   kube-master    &lt;none&gt;           &lt;none&gt;</span><br><span class="line">cert-manager-webhook-547567b88f-zfm9x      1&#x2F;1     Running   0          68s   10.42.0.17   kube-master    &lt;none&gt;           &lt;none&gt;</span><br></pre></td></tr></table></figure>


<p><strong>4. Configure the certificate issuers</strong></p>
<p>We now going to configure two certificate issuers from which signed x509 certificates can be obtained, such as <a target="_blank" rel="noopener" href="https://letsencrypt.org/">Let’s Encrypt</a>:</p>
<ul>
<li><em>letsencrypt-staging</em>: will be used for testing purpose only</li>
<li><em>letsencrypt-prod</em>: will be used for production purpose.</li>
</ul>
<p>Run the following commands (change <code>&lt;EMAIL&gt;</code> by your email).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: cert-manager.io&#x2F;v1alpha2</span><br><span class="line">kind: ClusterIssuer</span><br><span class="line">metadata:</span><br><span class="line">  name: letsencrypt-staging</span><br><span class="line">spec:</span><br><span class="line">  acme:</span><br><span class="line">    email: &lt;EMAIL&gt;</span><br><span class="line">    server: https:&#x2F;&#x2F;acme-staging-v02.api.letsencrypt.org&#x2F;directory</span><br><span class="line">    privateKeySecretRef:</span><br><span class="line">      name: letsencrypt-staging</span><br><span class="line">    solvers:</span><br><span class="line">    - http01:</span><br><span class="line">        ingress:</span><br><span class="line">          class: nginx</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">apiVersion: cert-manager.io&#x2F;v1alpha2</span><br><span class="line">kind: ClusterIssuer</span><br><span class="line">metadata:</span><br><span class="line">  name: letsencrypt-prod</span><br><span class="line">spec:</span><br><span class="line">  acme:</span><br><span class="line">    email: &lt;EMAIL&gt;</span><br><span class="line">    server: https:&#x2F;&#x2F;acme-v02.api.letsencrypt.org&#x2F;directory</span><br><span class="line">    privateKeySecretRef:</span><br><span class="line">      name: letsencrypt-prod</span><br><span class="line">    solvers:</span><br><span class="line">    - http01:</span><br><span class="line">        ingress:</span><br><span class="line">          class: nginx</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>Once done, we should be able to automatically issue a Let’s Encrypt’s certificate every time we configure an ingress with ssl.</p>
<p><strong>5. Example: Configuration of a ingress with SSL</strong></p>
<p>The following k8s config file allows to access the service <code>service_name</code> (port <code>80</code>) from outside the cluster with issuance of a certificate to the domain <code>domain</code>.</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">extensions/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Ingress</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">my-ingress</span></span><br><span class="line">  <span class="attr">annotations:</span></span><br><span class="line">    <span class="attr">kubernetes.io/ingress.class:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line">    <span class="attr">cert-manager.io/cluster-issuer:</span> <span class="string">&quot;letsencrypt-staging&quot;</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">tls:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">hosts:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&lt;domain&gt;</span></span><br><span class="line">    <span class="attr">secretName:</span> <span class="string">&quot;&lt;domain&gt;-staging-tls&quot;</span></span><br><span class="line">  <span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">host:</span> <span class="string">&lt;domain&gt;</span></span><br><span class="line">    <span class="attr">http:</span></span><br><span class="line">      <span class="attr">paths:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">path:</span> <span class="string">/</span></span><br><span class="line">          <span class="attr">backend:</span></span><br><span class="line">            <span class="attr">serviceName:</span> <span class="string">&lt;service_name&gt;</span></span><br><span class="line">            <span class="attr">servicePort:</span> <span class="number">80</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">```</span>             </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">### Manage storage</span></span><br><span class="line"></span><br><span class="line"><span class="string">Most</span> <span class="string">of</span> <span class="string">the</span> <span class="string">application</span> <span class="string">require</span> <span class="string">a</span> <span class="string">persistence</span> <span class="string">storage</span> <span class="string">to</span> <span class="string">store</span> <span class="string">data</span> <span class="string">and</span> <span class="string">allow</span> <span class="string">running</span> <span class="string">containers</span> <span class="string">to</span> <span class="string">access</span> <span class="string">this</span> <span class="string">storage</span> <span class="string">space</span> <span class="string">from</span> <span class="string">any</span> <span class="string">nodes</span> <span class="string">of</span> <span class="string">the</span> <span class="string">cluster.</span> <span class="string">In</span> <span class="string">the</span> <span class="string">previous</span> <span class="string">chapter,</span> <span class="string">we</span> <span class="string">set</span> <span class="string">up</span> <span class="string">a</span> <span class="string">Persistent</span> <span class="string">Volume</span> <span class="string">to</span> <span class="string">access</span> <span class="string">the</span> <span class="string">SSD</span> <span class="string">connected</span> <span class="string">to</span> <span class="string">the</span> <span class="string">master</span> <span class="string">node</span> <span class="string">via</span> <span class="string">NFS.</span></span><br><span class="line"></span><br><span class="line"><span class="string">**1.</span> <span class="string">Deploy</span> <span class="string">the</span> <span class="string">Persistent</span> <span class="string">Volume**</span></span><br><span class="line"></span><br><span class="line"><span class="string">In</span> <span class="string">order</span> <span class="string">to</span> <span class="string">expose</span> <span class="string">a</span> <span class="string">NFS</span> <span class="string">share</span> <span class="string">to</span> <span class="string">our</span> <span class="string">applications</span> <span class="string">deployed</span> <span class="string">on</span> <span class="string">Kubernetes,</span> <span class="attr">we will need first to define a Persistent Volume. Apply the following config:</span></span><br><span class="line"></span><br><span class="line"><span class="string">```yaml</span></span><br><span class="line"><span class="comment">## example.nfs.persistentvolume.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">PersistentVolume</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">example-ssd-volume</span></span><br><span class="line">  <span class="attr">labels:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">local</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">storageClassName:</span> <span class="string">manual</span></span><br><span class="line">  <span class="attr">capacity:</span></span><br><span class="line">    <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line">  <span class="attr">accessModes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">  <span class="attr">hostPath:</span></span><br><span class="line">    <span class="attr">path:</span> <span class="string">&quot;/mnt/ssd/example&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f example.nfs.persistentvolume.yml</span><br></pre></td></tr></table></figure>


<p><strong>2. Deploy the Persistent Volume Claim</strong></p>
<p>Now, we need to configure a Persistent Volume Claim which maps a Peristent Volume to a Deployment or Statefulset. Apply the</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## example.nfs.persistentvolumeclaim.yml</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line">  <span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">PersistentVolumeClaim</span></span><br><span class="line">  <span class="attr">metadata:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">example-ssd-volume</span></span><br><span class="line">  <span class="attr">spec:</span></span><br><span class="line">    <span class="attr">storageClassName:</span> <span class="string">manual</span></span><br><span class="line">    <span class="attr">accessModes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ReadWriteOnce</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="attr">requests:</span></span><br><span class="line">        <span class="attr">storage:</span> <span class="string">1Gi</span></span><br><span class="line"><span class="meta">---</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f example.nfs.persistentvolumeclaim.yml</span><br></pre></td></tr></table></figure>



<p><strong>3. Checkout the result</strong></p>
<p>You should be able to query the cluster to find our Persistent Volume and Persistent Volume Claim.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pv</span><br><span class="line"></span><br><span class="line">NAME                 CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS      CLAIM   STORAGECLASS   REASON   AGE</span><br><span class="line">example-ssd-volume   1Gi        RWO            Retain           Available           manual                  3s</span><br><span class="line"></span><br><span class="line">$ kubectl get pvc -A</span><br><span class="line"></span><br><span class="line">NAMESPACE   NAME                 STATUS   VOLUME               CAPACITY   ACCESS MODES   STORAGECLASS   AGE</span><br><span class="line">default     example-ssd-volume   Bound    example-ssd-volume   1Gi        RWO            manual         6s</span><br></pre></td></tr></table></figure>

<p>This method will be used to declare persistent storage volume for each of our application. You can learn more about Persistent Volume <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/storage/persistent-volumes/">here</a>.</p>
<h3 id="Install-Kubernetes-Dashboard"><a href="#Install-Kubernetes-Dashboard" class="headerlink" title="Install Kubernetes Dashboard"></a>Install Kubernetes Dashboard</h3><p><a target="_blank" rel="noopener" href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">Kubernetes Dashboard</a> is a web-based Kubernetes user interface allowing similar operations as <em>kubectl</em>.</p>
<p><img src="https://s14-eu5.startpage.com/cgi-bin/serveimage?url=https://miro.medium.com/max/5760/1*xA3NgdUJHa0t09NH3xPv-A.png&sp=c9182253abe18efb13bc730e52fda946"></p>
<p><strong>1. Install kubernetes-dashboard via the official “recommended” manifests file</strong></p>
<p>Execute the following command and replace <code>&lt;VERSION&gt;</code> by the latest version (see <a target="_blank" rel="noopener" href="https://github.com/kubernetes/dashboard/releases">release page</a>)</p>
<p><em>Tested with version: <strong>v2.0.3</strong></em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl apply -f https:&#x2F;&#x2F;raw.githubusercontent.com&#x2F;kubernetes&#x2F;dashboard&#x2F;&lt;VERSION&gt;&#x2F;aio&#x2F;deploy&#x2F;recommended.yaml</span><br></pre></td></tr></table></figure>


<p>After a few seconds, you should see to pods running in the namespace <code>kubernetes-dashboard</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl get pods -n kubernetes-dashboard</span><br><span class="line"></span><br><span class="line">NAME                                        READY   STATUS    RESTARTS   AGE</span><br><span class="line">dashboard-metrics-scraper-b68468655-jg6pz   1&#x2F;1     Running   0          26m</span><br><span class="line">kubernetes-dashboard-64999dbccd-79whq       1&#x2F;1     Running   0          26m</span><br></pre></td></tr></table></figure>


<p><strong>2. Create <code>admin-user</code> to connect kubernetes-dashboard</strong></p>
<p>According to the <a target="_blank" rel="noopener" href="https://github.com/kubernetes/dashboard/blob/master/docs/user/access-control/creating-sample-user.md">wiki</a>, create a new user named <code>admin-user</code> to grant this user admin permissions and login to Dashboard using bearer token tied to this user.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ cat &lt;&lt;EOF | kubectl apply -f -</span><br><span class="line">---</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: admin-user</span><br><span class="line">  namespace: kubernetes-dashboard</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io&#x2F;v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: admin-user</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-admin</span><br><span class="line">subjects:</span><br><span class="line">- kind: ServiceAccount</span><br><span class="line">  name: admin-user</span><br><span class="line">  namespace: kubernetes-dashboard</span><br><span class="line">---</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>


<p><strong>3. Retrieve the unique access token of <code>admin-user</code></strong></p>
<p>In order to authenticate to the dashboard web page, we will need to provide a token we can retrieve by executing the command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl -n kubernetes-dashboard describe secret $(kubectl -n kubernetes-dashboard get secret | grep admin-user | awk &#39;&#123;print $1&#125;&#39;)</span><br><span class="line"></span><br><span class="line">Name:         admin-user-token-tr2dp</span><br><span class="line">Namespace:    kubernetes-dashboard</span><br><span class="line">Labels:       &lt;none&gt;</span><br><span class="line">Annotations:  kubernetes.io&#x2F;service-account.name: admin-user</span><br><span class="line">              kubernetes.io&#x2F;service-account.uid: 9507154d-0742-4af0-87c9-1fe97143f5fe</span><br><span class="line"></span><br><span class="line">Type:  kubernetes.io&#x2F;service-account-token</span><br><span class="line"></span><br><span class="line">Data</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line">ca.crt:     526 bytes</span><br><span class="line">namespace:  20 bytes</span><br><span class="line">token:      eyJhbGciOiJSUzI1Ni...GscCR9APmOxm53jwLj8XFqw [COPY HERE]</span><br></pre></td></tr></table></figure>

<p><em>Copy the token value</em></p>
<p><strong>4. Create a secure channel to access the kubernetes-dashboard</strong></p>
<p>To access kubernetes-dashboard from your local machine, you must create a secure channel to your Kubernetes cluster. Run the following command:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$  kubectl proxy</span><br><span class="line"></span><br><span class="line">Starting to serve on 127.0.0.1:8001</span><br></pre></td></tr></table></figure>


<p><strong>5. Connect to kubernetes-dashboard</strong></p>
<p>Now we have a secure channel, you can access kubernetes-dashboard via the following URL: <a target="_blank" rel="noopener" href="http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/">http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/</a>.</p>
<p>Select “Token”, copy/paste the token previously retrieved and click on “Sign in”.</p>
<p><img src="https://i.imgur.com/7xW77VN.png"></p>
<p>Well done, you have now access to a nice web interface to visialise and manage all the Objects of your Kubernetes cluster (<em>you can switch namespace with the dropdown on the left menu</em>).</p>
<p><img src="https://i.imgur.com/Ky9zXpH.png"></p>
<h3 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h3><p>In conclusion of this article, we now have a ready to use Kubernetes cluster to self-host applications. In the next articles, we will learn how to deploy specific applications such as a Media manager with Plex, a self-hosted file sharing solution similar to DropBox and more.</p>
<h3 id="Teardown"><a href="#Teardown" class="headerlink" title="Teardown"></a>Teardown</h3><p>If you want to uninstall completely the Kubernetes from a machine.</p>
<p><strong>1. Worker node</strong></p>
<p>Connect to the worker node and run the following commands:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo &#x2F;usr&#x2F;local&#x2F;bin&#x2F;k3s-agent-uninstall.sh</span><br><span class="line">$ sudo rm -rf &#x2F;var&#x2F;lib&#x2F;rancher</span><br></pre></td></tr></table></figure>


<p><strong>2. Master node</strong></p>
<p>Connect to the master node and run the following commands:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo &#x2F;usr&#x2F;local&#x2F;bin&#x2F;k3s-uninstall.sh</span><br><span class="line">$ sudo rm -rf &#x2F;var&#x2F;lib&#x2F;rancher</span><br></pre></td></tr></table></figure>




<h3 id="Known-Issues"><a href="#Known-Issues" class="headerlink" title="Known Issues"></a>Known Issues</h3><ul>
<li>cert-manager doesn’t issue a certificate, it could be a DNS problem: <a target="_blank" rel="noopener" href="https://project.kube.thejimnicholson.com/2020/04/17/cert-manager-works.html">Cert Manager works! (Jim Nicholson)</a></li>
</ul>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">Home</a></li>
         
          <li><a href="/blog/">Blog</a></li>
         
          <li><a href="/guides/">Guides</a></li>
         
          <li><a href="/about/">About me</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#Introduction"><span class="toc-number">1.</span> <span class="toc-text">Introduction</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-k3s-server-master-node"><span class="toc-number">2.</span> <span class="toc-text">Install k3s server (master node)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-k3s-agent-worker-nodes"><span class="toc-number">3.</span> <span class="toc-text">Install k3s agent (worker nodes)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Connect-remotely-to-the-cluster"><span class="toc-number">4.</span> <span class="toc-text">Connect remotely to the cluster</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-Helm-version-gt-3-x-y-Kubernetes-Package-Manager"><span class="toc-number">5.</span> <span class="toc-text">Install Helm (version &gt;&#x3D; 3.x.y) - Kubernetes Package Manager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-MetalLB-Kubernetes-Load-Balancer"><span class="toc-number">6.</span> <span class="toc-text">Install MetalLB - Kubernetes Load Balancer</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-Nginx-Web-Proxy"><span class="toc-number">7.</span> <span class="toc-text">Install Nginx - Web Proxy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-cert-manager"><span class="toc-number">8.</span> <span class="toc-text">Install cert-manager</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Install-Kubernetes-Dashboard"><span class="toc-number">9.</span> <span class="toc-text">Install Kubernetes Dashboard</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Conclusion"><span class="toc-number">10.</span> <span class="toc-text">Conclusion</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Teardown"><span class="toc-number">11.</span> <span class="toc-text">Teardown</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Known-Issues"><span class="toc-number">12.</span> <span class="toc-text">Known Issues</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&text=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&title=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&is_video=false&description=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications&body=Check out this article: https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/"><i class="fas fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&title=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&title=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&title=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&title=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&name=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=https://gr3g.tech/2020/04/12/install-and-configure-a-kubernetes-cluster-w/&t=(K3S - 3/8) Install and configure a Kubernetes cluster with k3s to self-host applications"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2019-2026
    Gr3g
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/blog/">Blog</a></li>
        
          <li><a href="/guides/">Guides</a></li>
        
          <li><a href="/about/">About me</a></li>
        
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->

<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">


<link rel="stylesheet" href="/lib/justified-gallery/css/justifiedGallery.min.css">


    <!-- jquery -->

<script src="/lib/jquery/jquery.min.js"></script>


<script src="/lib/justified-gallery/js/jquery.justifiedGallery.min.js"></script>

<!-- clipboard -->

  
<script src="/lib/clipboard/clipboard.min.js"></script>

  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5XMQMBKWMY"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-5XMQMBKWMY');
    </script>

<!-- Baidu Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->


</body>
</html>